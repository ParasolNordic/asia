{
  "version": "1.0",
  "module": "npc_diplomacy_ruleset",
  "description": "NPC-kohtaiset diplomatiamallit, jotka pohjautuvat historiallisiin suhteisiin, fraktiotekijöihin ja konfliktisääntöihin. Sääntöstö on suunniteltu niin, ettei pelaaja voi jäädä jumiin: kaikki NPC:t ovat avautuvia pehmeillä ehdoilla, ja vaihtoehtoisia reittejä on aina olemassa.",

  "global_parameters": {
    "opinion_range": [-100, 100],
    "soft_lock_threshold": -40,
    "hard_lock_threshold": -80,
    "minimum_progress_paths": 3,
    "auto_recovery_enabled": true,
    "auto_recovery_rate": {
      "per_encounter": 2,
      "per_major_act": 5
    },
    "softening_rules": {
      "description": "Jos useampi pää-NPC putoaa alle soft_lock_threshold, peli tarjoaa aina vaihtoehtoisia reittejä.",
      "trigger_threshold": 3,
      "effect": "increase_all_negative_relations_by_10_temporarily"
    }
  },

  "npc_rules": {

    "trepov": {
      "name": "Dmitri Trepov",
      "faction_alignment": { "RUS": 0.7, "RUS_SCI": 0.2, "BRIT": -0.3 },
      "min_progress_state": "prologue",
      "requires": [],
      "likes": ["loyalty_to_russia", "accurate_reports", "obedience"],
      "dislikes": ["british_alignment", "independent_action"],
      "opinion_modifiers": {
        "on_report_success": 10,
        "on_report_failure": -15
      },
      "unlock_paths": ["KF", "Samsonov"],
      "fallback_rule": "If Trepov_opinion <= -60, KF automatically provides alternative access to Russian storyline."
    },

    "kf": {
      "name": "Everstiluutnantti K.F.",
      "faction_alignment": { "RUS": 0.6, "RUS_SCI": 0.3 },
      "requires": [],
      "likes": ["obedience", "dutiful_conduct"],
      "dislikes": [],
      "fallback_rule": "KF cannot hard-block progress; negative opinion only restricts bonuses."
    },

    "samsonov": {
      "name": "Aleksandr Samsonov",
      "faction_alignment": { "RUS": 0.5, "CLANS": -0.1 },
      "likes": ["competence", "military_efficiency"],
      "dislikes": ["collaborating_with_kurmanjan"],
      "conflict_links": ["kurmanjan_datka"],
      "conflict_rule": "If you ally with Kurmanjan too strongly (MUSLIM > 40), Samsonov opinion -20.",
      "fallback_rule": "Samsonov cannot lock travel—Sokolov or Enbom can substitute military/logistics role."
    },

    "sokolov": {
      "name": "Kasakka Sergei Sokolov",
      "faction_alignment": { "CLANS": 0.5, "RUS": 0.3 },
      "likes": ["bravery", "fair_treatment"],
      "dislikes": ["cowardice"],
      "fallback_rule": "Sokolov always remains recruitable unless opinion < -80, and even then can be rehired using gifts or deeds."
    },

    "enbom": {
      "name": "Nils Gustaf Enbom",
      "faction_alignment": { "ARCH_SCI": 0.4, "CLANS": 0.4 },
      "likes": ["peace", "ethnographic_respect"],
      "dislikes": ["aggression"],
      "special_rules": {
        "peacekeeper_buff": "If player avoids violence in 3 consecutive encounters, Enbom gives +10 MUSLIM reputation."
      }
    },

    "kurmanjan_datka": {
      "name": "Kurmanjan Datka",
      "faction_alignment": { "MUSLIM": 0.5, "CLANS": 0.5 },
      "likes": ["honor", "fair_negotiation"],
      "dislikes": ["russian_aggression"],
      "conflict_links": ["samsonov", "harmaa_susi"],
      "conflict_rules": [
        "If MUSLIM > 40 and RUS > 40: trigger soft_conflict, not hard-lock.",
        "If allied_with_kurmanjan and help_samsonov: small penalty only (-10)."
      ],
      "fallback_rule": "Kurmanjan always allows at least one path through the mountains, regardless of opinion."
    },

    "macartney": {
      "name": "Sir George Macartney",
      "faction_alignment": { "BRIT": 0.7, "ARCH_SCI": 0.2, "RUS": -0.2 },
      "likes": ["espionage_data", "political_balance"],
      "dislikes": ["excessive_russian_alignment"],
      "unlock_paths": ["stein", "catherine_macartney"],
      "fallback_rule": "If Macartney rejects you, Stein or Catherine can unlock same information paths."
    },

    "catherine_macartney": {
      "name": "Lady Catherine Macartney",
      "faction_alignment": { "BRIT": 0.6 },
      "likes": ["tact", "good_manners"],
      "fallback_rule": "Catherine never fully blocks progress; she softens BRIT penalties generated by George."
    },

    "subhi_effendi": {
      "name": "Subhi Effendi",
      "faction_alignment": { "MUSLIM": 0.6, "QING": -0.3, "BRIT": -0.3 },
      "likes": ["respect_to_muslims"],
      "dislikes": ["british_alignment"],
      "fallback_rule": "If Subhi dislikes you, Tursun Beg can substitute as Muslim-faction gateway."
    },

    "kolokolov": {
      "name": "Sergei A. Kolokolov",
      "faction_alignment": { "RUS": 0.5, "RUS_SCI": 0.5 },
      "likes": ["scientific_integrity"],
      "dislikes": ["british_espionage"],
      "conflict_links": ["macartney"],
      "fallback_rule": "If Kolokolov blocks a route, Krotkov will open it with an extra diplomacy test."
    },

    "krotkov": {
      "name": "Nikolai N. Krotkov",
      "faction_alignment": { "RUS_SCI": 0.6 },
      "likes": ["manuscripts", "discretion"],
      "fallback_rule": "Krotkov cannot block progress; he always provides a 'nerd-route' to bypass political problems."
    },

    "pelliot": {
      "name": "Paul Pelliot",
      "faction_alignment": { "ARCH_SCI": 0.7, "BRIT": -0.2 },
      "likes": ["manuscripts_first"],
      "dislikes": ["stein", "le_coq"],
      "conflict_links": ["stein", "le_coq"],
      "fallback_rule": "If Pelliot refuses cooperation, Stein or Le Coq automatically offer alternate quests."
    },

    "otani": {
      "name": "Count Ōtani Kōzui",
      "faction_alignment": { "ARCH_SCI": 0.6 },
      "likes": ["cooperative_exploration"],
      "dislikes": ["opportunism"],
      "fallback_rule": "Ōtani never blocks; he reduces ARCH_SCI penalties if relations are bad."
    },

    "le_coq": {
      "name": "Albert von Le Coq",
      "faction_alignment": { "ARCH_SCI": 0.6 },
      "likes": ["german_efficiency"],
      "dislikes": ["french_superiority", "pelliot"],
      "fallback_rule": "If Le Coq blocks cooperation, Kozlov or Stein offer a similar investigation route."
    },

    "stein": {
      "name": "Aurel Stein",
      "faction_alignment": { "ARCH_SCI": 0.7, "BRIT": 0.4 },
      "likes": ["scientific_precision"],
      "dislikes": ["revealing_his_secrets"],
      "conflict_links": ["pelliot", "le_coq"],
      "fallback_rule": "Stein always offers at least a minor quest, even at low opinion."
    },

    "taixu": {
      "name": "Taixu",
      "faction_alignment": { "RELIG_TRACK": 0.5, "TIIBET": 0.4 },
      "likes": ["spiritual_respect"],
      "dislikes": ["violence"],
      "fallback_rule": "Low Taixu opinion only affects spiritual rewards, not main progression."
    },

    "punaviitta_lama": {
      "name": "Punaviitta-Lama",
      "faction_alignment": { "TIIBET": 0.6, "RELIG_TRACK": 0.4 },
      "likes": ["religious_deference"],
      "dislikes": ["disrespect"],
      "fallback_rule": "If relationship drops, Taixu or Dalai-lama provides alternate spiritual content."
    },

    "zhang_zhidong": {
      "name": "Zhang Zhidong",
      "faction_alignment": { "QING": 0.7 },
      "likes": ["modernization"],
      "dislikes": ["supporting_Yuan"],
      "conflict_links": ["yuan_shikai"],
      "fallback_rule": "If Zhang rejects you, Li Wen can open Qing-bureaucracy routes."
    },

    "yuan_shikai": {
      "name": "Yuan Shikai",
      "faction_alignment": { "QING": 0.6 },
      "likes": ["military_efficiency"],
      "dislikes": ["supporting_zaifeng"],
      "conflict_links": ["zaifeng", "dalai_lama", "kozlov"],
      "fallback_rule": "Song Yun or Zhao Rong offer fallback access to Qing-military paths."
    },

    "zaifeng": {
      "name": "Prince Chun (Zaifeng)",
      "faction_alignment": { "QING": 0.6 },
      "likes": ["loyalty_to_emperor"],
      "dislikes": ["yuan_shikai"],
      "fallback_rule": "If Zaifeng blocks, Zhang Zhidong opens the political gate instead."
    },

    "li_wen": {
      "name": "Mandariini Li Wen",
      "faction_alignment": { "QING": 0.5 },
      "likes": ["procedures"],
      "dislikes": ["shortcuts"],
      "fallback_rule": "Li Wen never fully blocks; Song Yun bypasses bureaucracy if needed."
    },

    "zhao_rong": {
      "name": "Kenraali Zhao Rong",
      "faction_alignment": { "QING": 0.5 },
      "likes": ["honor"],
      "dislikes": ["lying"],
      "fallback_rule": "If Zhao Rong is hostile, Yuan Shikai or Zhang Zhidong can override his block."
    },

    "song_yun": {
      "name": "Song Yun",
      "faction_alignment": { "QING": 0.6, "MUSLIM": -0.3 },
      "likes": ["Qing_loyalty"],
      "dislikes": ["muslim_alignment"],
      "fallback_rule": "Song Yun cannot hard-lock progression; he may apply higher fines instead of blocking."
    },

    "dalai_lama": {
      "name": "13th Dalai-Lama",
      "faction_alignment": { "TIIBET": 0.7, "RELIG_TRACK": 0.4, "QING": -0.3 },
      "likes": ["honor", "spiritual_respect"],
      "dislikes": ["supporting_qing_over_tibet"],
      "fallback_rule": "Dalai-lama never fully blocks final act; he only alters its tone or reward structure."
    },

    "kozlov": {
      "name": "Pyotr Kuzlov",
      "faction_alignment": { "RUS_SCI": 0.6, "ARCH_SCI": 0.4 },
      "likes": ["exploration"],
      "dislikes": ["british_alignment"],
      "conflict_links": ["yuan_shikai"],
      "fallback_rule": "If Kozlov is unfriendly, Le Coq or Stein can provide alternate exploration support."
    },

    "harmaa_susi": {
      "name": "Harmaa Susi",
      "faction_alignment": { "BANDITS": 0.7, "CLANS": 0.2 },
      "likes": ["tribute", "fear"],
      "dislikes": ["law_enforcement"],
      "conflict_links": ["kurmanjan_datka", "tursun_beg"],
      "fallback_rule": "Even if hostile, Harmaa Susi always provides a bribed passage at a higher cost, preventing hard-lock."
    },

    "tursun_beg": {
      "name": "Tursun Beg",
      "faction_alignment": { "MUSLIM": 0.6, "CLANS": 0.3 },
      "likes": ["mutual_respect"],
      "dislikes": ["collaboration_with_song_yun"],
      "fallback_rule": "If Tursun Beg refuses help, Kurmanjan can override him or reroute the caravan."
    }
  },

  "conflict_resolution": {
    "description": "Konfliktisäännöt integroituvat NPC-logiikkaan. Ne eivät koskaan aiheuta pysyvää etenemisen pysähdystä.",
    "rules": [
      {
        "id": "brit_vs_rus_alignment",
        "condition": "BRIT > 40 AND RUS > 40",
        "effect": "All RUS-aligned NPCs opinion -10 (soft penalty)",
        "compensation": "Kolokolov creates peaceful neutral mission to restore balance"
      },
      {
        "id": "tibet_vs_qing_alignment",
        "condition": "TIIBET > 40 AND QING > 40",
        "effect": "QING NPCs opinion -15",
        "compensation": "Taixu or Dalai-lama provides 'Reconciliation ritual' restoring +10 QING"
      },
      {
        "id": "muslim_vs_qing_alignment",
        "condition": "MUSLIM > 40 AND QING > 40",
        "effect": "Diplomatic standoff (no block)",
        "compensation": "Kurmanjan OR Song Yun provides bypass route"
      }
    ]
  },

  "progression_guarantees": {
    "never_block_main_story": true,
    "always_available_paths": ["Enbom", "Sokolov", "Krotkov", "Taixu"],
    "regional_alternatives": {
      "kashgar": ["Macartney", "Subhi Effendi", "Kolokolov"],
      "turpan": ["Stein", "Pelliot", "Le Coq"],
      "qing": ["Zhang Zhidong", "Li Wen", "Song Yun"]
    }
  }
}
